<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Quiz multijoueur</title>
</head>
<body>
    <h1>🎮 Quiz Multijoueur</h1>

    <div id="connexion">
        <input id="pseudo" placeholder="Votre pseudo">
        <input id="room" placeholder="Nom de la salle">
        <button onclick="rejoindre()">Rejoindre</button>
    </div>

    <div id="quiz" style="display:none;">
        <h2 id="question"></h2>
        <div id="choix-container"></div>
        <ul id="joueurs"></ul>
        <button onclick="lancerQuiz()">🚀 Démarrer le quiz</button>
    </div>

    <div id="classement" style="display:none;">
        <h2>🏁 Classement Final</h2>
        <ol id="resultats"></ol>
    </div>

<script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let room = '';

        function rejoindre() {
            const pseudo = document.getElementById('pseudo').value;
            room = document.getElementById('room').value;

            socket.emit('joinRoom', { pseudo, room });

            document.getElementById('connexion').style.display = 'none';
            document.getElementById('quiz').style.display = 'block';
        }

        function lancerQuiz() {
            socket.emit('startQuiz');
        }

        socket.on('newQuestion', (data) => {
            document.getElementById('question').textContent = `Q${data.numero} : ${data.question}`;

            const container = document.getElementById('choix-container');
            container.innerHTML = '';

            data.choix.forEach(option => {
                const btn = document.createElement('button');
                btn.textContent = option;
                btn.onclick = () => {
                    socket.emit('submitAnswer', option);
                    container.innerHTML = '<p>✅ Réponse envoyée !</p>';
                };
                container.appendChild(btn);
            });
        });


        socket.on('updatePlayers', (joueurs) => {
            const ul = document.getElementById('joueurs');
            ul.innerHTML = '';
            joueurs.forEach(joueur => {
                const li = document.createElement('li');
                li.textContent = `${joueur.pseudo} - ${joueur.score} pts`;
                ul.appendChild(li);
            });
        });

        socket.on('endQuiz', (classement) => {
            document.getElementById('quiz').style.display = 'none';
            document.getElementById('classement').style.display = 'block';

            const ol = document.getElementById('resultats');
            ol.innerHTML = '';
            classement.forEach(joueur => {
                const li = document.createElement('li');
                li.textContent = `${joueur.pseudo} - ${joueur.score} pts`;
                ol.appendChild(li);
            });
        });
    </script>
</body>
</html>
